---
import BaseLayout from '@/layouts/BaseLayout.astro'
import { getStrapiBlogs, getStrapiBlogBySlug } from '@/lib/strapi'

// 1. 告诉Astro需要为哪些slug生成静态页面
export async function getStaticPaths() {
  const blogs = await getStrapiBlogs();
  return blogs.map((blog) => ({
    params: { slug: blog.slug },
    props: { blog }, // 将整篇文章数据作为props传递
  }));
}

// 2. 从Astro接收props
const { blog } = Astro.props;
---

<BaseLayout title={blog.title} description={blog.excerpt}>
  <article class="prose max-w-none">
    {blog.cover?.url && (
      <img src={blog.cover.url} alt={`Cover for ${blog.title}`} class="rounded w-full mb-8" />
    )}
    <h1 class="!mb-2">{blog.title}</h1>
    <p class="!mt-0 text-lg text-gray-600">By {blog.author} • Published on {new Date(blog.publishedAt).toDateString()}</p>
    
    <hr class="hr-line" />
    
    {/* 渲染富文本内容区块 */}
    <div class="strapi-content">
      {
        blog.content && blog.content.map((block, index) => {
          if (block.type === 'paragraph') {
            return (
              <p key={index}>
                {block.children.map((child, childIndex) => {
                  if (child.type === 'text') {
                    // 这里可以扩展处理加粗、斜体等格式
                    return <span key={childIndex}>{child.text}</span>;
                  }
                  return null;
                })}
              </p>
            );
          }
          // 可以在此处添加对标题、列表等其他块类型的支持
          return null;
        })
      }
    </div>
    
    <hr class="hr-line" />
    
    <a href="/strapi-blog" class="prose-link">← Back to all Strapi Blogs</a>
  </article>
</BaseLayout>

<style>
/* 为渲染的内容添加一些基本样式 */
.strapi-content p {
  margin-bottom: 1em;
  line-height: 1.6;
}
</style>
